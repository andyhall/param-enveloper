!function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);class a{constructor(e){this.ctx=e,this.zeroRampTarget=.01}initParam(e,t){var n=this.ctx.currentTime;e.cancelScheduledValues(0),e.setValueAtTime(t,0),n>0&&e.setValueAtTime(t,n),e.__paramEnveloperEvents=[new u(r,t,t,0,n)]}startEnvelope(e,t){c(e,this.ctx.currentTime),function(e,t){var n=e.__paramEnveloperEvents,a=n[n.length-1];if(t<=a.t1)return;var i=a.v1;e.setValueAtTime(i,t),n.push(new u(r,i,i,a.t1,t))}(e,t=Math.max(t,this.ctx.currentTime));var n=e.__paramEnveloperEvents,a=p(n,t);n.length=n.indexOf(a)+1,t>0&&e.cancelScheduledValues(t);var i=d(a,t);a.t1=t,a.v1=i,a.type===r||(a.type===l?e.linearRampToValueAtTime(i,t):a.type===o?e.exponentialRampToValueAtTime(i,t):a.type)}addHold(e,t){c(e,this.ctx.currentTime);var n=e.__paramEnveloperEvents,a=n[n.length-1],i=a.v1,l=a.t1,o=i,p=l+t;n.push(new u(r,i,o,l,p)),e.setValueAtTime(i,p)}addRamp(e,t,n,a){c(e,this.ctx.currentTime);var r=e.__paramEnveloperEvents,i=r[r.length-1],p=i.v1,d=i.t1,m=n,v=d+t;a?(0===m&&(m=this.zeroRampTarget),e.exponentialRampToValueAtTime(m,v)):e.linearRampToValueAtTime(m,v);var s=a?o:l;r.push(new u(s,p,m,d,v))}addSweep(e,t,n,a){c(e,this.ctx.currentTime);var r,l,o=e.__paramEnveloperEvents,p=o[o.length-1],d=p.v1,v=p.t1;e.setTargetAtTime(n,v,a),t>0?(r=v+t,l=m(t,d,n,a)):(r=1/0,l=n);var s=new u(i,d,l,v,r);s.k=a,s.tgt=n,o.push(s)}getValueAtTime(e,t){c(e,this.ctx.currentTime);var n=p(e.__paramEnveloperEvents,t);return t>n.t1?n.v1:d(n,t)}}var r=1,i=2,l=3,o=4;function u(e,t,n,a,r){this.type=e,this.v0=+t,this.v1=+n,this.t0=+a,this.t1=+r,this.k=.1,this.tgt=.1}function c(e,t){var n=e.__paramEnveloperEvents,a=n[n.length-1],i=-1;if(n.some((e,n)=>{if(e.t1<=t)return!0;i=n}),i>=0&&n.splice(0,i+1),0===n.length){var l=a.v1;e.setValueAtTime(l,t),n.push(new u(r,l,l,0,t))}}function p(e,t){var n=null;if(e.some(e=>{if(n=e,t<e.t1)return!0}),!n)throw"Internal problem, time not within event list";return n}function d(e,t){if(e.type===r)return e.v0;var n=t-e.t0;return e.type===l?function(e,t,n,a,r){return t+(n-t)*e/(r-a)}(n,e.v0,e.v1,e.t0,e.t1):e.type===o?function(e,t,n,a,r){return t*Math.pow(n/t,e/(r-a))}(n,e.v0,e.v1,e.t0,e.t1):e.type===i?m(n,e.v0,e.tgt,e.k):void 0}function m(e,t,n,a){return n+(t-n)*Math.exp(-e/a)}var v=document.createElement("p");v.innerHTML="Press/release spacebar to start/end an envelope";var s,f,h=document.createElement("canvas");h.width=1e3,h.height=260,h.style.backgroundColor="black",v.style.margin=h.style.margin="20px",document.body.appendChild(v),document.body.appendChild(h),document.addEventListener("keydown",e=>{" "===e.key&&(e.preventDefault(),function(){if(g)return;g=!0,f||T();var e=f.ctx.currentTime+0,t=f.enveloper,n=f.param;t.startEnvelope(n,e),t.addRamp(n,.5,1,!1),t.addHold(n,.5),t.addRamp(n,.5,.5,!0),t.addSweep(n,0,.2,2)}())}),document.addEventListener("keyup",e=>{" "===e.key&&function(){g=!1,f||T();var e=f.ctx.currentTime+0,t=f.enveloper,n=f.param;t.startEnvelope(n,e),t.addSweep(n,0,0,1)}()}),function e(){if(requestAnimationFrame(e),f){s||function(){var e=h.getContext("2d");e.fillStyle="#000",e.fillRect(0,0,h.width,h.height);var t=new Float32Array(256);s={drawCtx:e,data:t,x:2}}(),f.analyzer.getFloatTimeDomainData(s.data);var t=s.x,n=256*s.data.reduce((e,t)=>Math.max(e,t),0);s.drawCtx.fillStyle="#000",s.drawCtx.fillRect(t,0,2,h.height),s.drawCtx.fillStyle="#FFF",s.drawCtx.fillRect(t,h.height-n,2,n),s.x=(t+2)%h.width}}();var g=!1;function T(){var e=new AudioContext,t=e.createOscillator();t.start();var n=e.createGain(),r=e.createAnalyser();t.connect(n),n.connect(e.destination),n.connect(r);var i=n.gain,l=new a(e);l.initParam(i,0),f={ctx:e,enveloper:l,param:i,analyzer:r},function(e,t){var n=(e,t)=>{if(Math.abs(e-t)>.01)throw"?"};e.initParam(t,0),e.startEnvelope(t,1),e.addHold(t,1),e.addRamp(t,1,1),n(0,e.getValueAtTime(t,0)),n(0,e.getValueAtTime(t,1)),n(0,e.getValueAtTime(t,2)),n(.5,e.getValueAtTime(t,2.5)),n(1,e.getValueAtTime(t,3)),n(1,e.getValueAtTime(t,4)),e.startEnvelope(t,2.5),e.addHold(t,1),e.addRamp(t,.5,1),n(.25,e.getValueAtTime(t,2.25)),n(.5,e.getValueAtTime(t,2.5)),n(.5,e.getValueAtTime(t,3.5)),n(.75,e.getValueAtTime(t,3.75)),n(1,e.getValueAtTime(t,4)),n(1,e.getValueAtTime(t,5))}(l,e.createGain().gain)}}]);