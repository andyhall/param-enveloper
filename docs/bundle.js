!function(e){var t={};function a(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t,a){"use strict";a.r(t);class r{constructor(e){this.ctx=e,this.zeroRampTarget=.001}initParam(e,t){e.cancelScheduledValues(0),e.__paramEnveloperEvents=[new d(n,t,t,0,0)],e.setValueAtTime(t,0),s("init:  param base set to",t,"time 0")}startEnvelope(e,t){var a=this.ctx.currentTime;t>a||(t=a);var r=e.__paramEnveloperEvents,m=r[r.length-1];if(function(e,t){for(;e.length>0&&e[0].t1<t;)e.shift()}(r,a),0===r.length||t>m.t1){var v=m.v1;return r.push(new d(n,v,v,0,t)),e.setValueAtTime(v,t),void s("start:  fresh envelope, value",v," from time",t)}var c=p(r,t);if(!c)throw"event list conformance bug, should not happen!";if(r.length=r.indexOf(c)+1,t===c.t1)return e.cancelScheduledValues(t+1e-4),void s("start:  envelope begins: value",m.v1,"from time",t);e.cancelScheduledValues(t);var f=u(c,t);c.v1=f,c.t1=t,s("start:  envelope begins: value",f,"from time",t),c.type===n?(e.setValueAtTime(f,t),s("--set value",f,"time",t)):c.type===l?(e.linearRampToValueAtTime(f,t),s("--ramp to",f,"time",t)):c.type===o?(f=f||this.zeroRampTarget,e.exponentialRampToValueAtTime(f,t),s("--exp ramp to",f,"time",t)):c.type===i&&(e.setValueAtTime(f,t),s("--set value",f,"time",t))}addHold(e,t){if(t>0){var a=e.__paramEnveloperEvents,r=a[a.length-1];if(r.t1===1/0){var i=r.t0+t;s("hold:   during sweep, start new envelope from time:",i),this.startEnvelope(e,i)}else{var l=r.v1,o=r.t1,p=l,u=o+t;a.push(new d(n,l,p,o,u)),e.setValueAtTime(p,u),s("hold:   val",p,"until time",u)}}}addRamp(e,t,a,r){t>1e-4||(t=1e-4);var n=e.__paramEnveloperEvents,i=n[n.length-1],p=i.v1,u=i.t1;if(i.t1===1/0)throw"Error - change scheduled after a sweep with infinite duration";var m=a,v=u+t;r?(p=p||this.zeroRampTarget,m=m||this.zeroRampTarget,e.exponentialRampToValueAtTime(m,v)):e.linearRampToValueAtTime(m,v);var c=r?o:l;n.push(new d(c,p,m,u,v)),s("ramp:  to val",m,"time",v,r?"exp":"linear")}addSweep(e,t,a,r){var n,l,o=e.__paramEnveloperEvents,p=o[o.length-1],u=p.v1,v=p.t1;if(p.t1===1/0)throw"Error - change scheduled after a sweep with infinite duration";e.setTargetAtTime(a,v,r),t>0?(n=v+t,l=m(t,u,a,r)):(n=1/0,l=a);var c=new d(i,u,l,v,n);c.k=r,c.tgt=a,o.push(c),s("sweep: to target",a,"const",r,"from time",v,"to",n)}getValueAtTime(e,t){var a=e.__paramEnveloperEvents,r=p(a,t);return r?u(r,t):a[a.length-1].v1}}var n=1,i=2,l=3,o=4;function d(e,t,a,r,n){this.type=e,this.v0=+t,this.v1=+a,this.t0=+r,this.t1=+n,this.k=.1,this.tgt=.1}function p(e,t){for(var a=0;a<e.length;a++)if(!(t>e[a].t1))return e[a];return null}function u(e,t){if(e.type===n)return e.v0;var a=t-e.t0;return e.type===l?function(e,t,a,r){return t+(a-t)*e/r}(a,e.v0,e.v1,e.t1-e.t0):e.type===o?function(e,t,a,r){return t*Math.pow(a/t,e/r)}(a,e.v0,e.v1,e.t1-e.t0):e.type===i?m(a,e.v0,e.tgt,e.k):void 0}function m(e,t,a,r){return a+(t-a)*Math.exp(-e/r)}var s=()=>{},v=document.createElement("p");v.innerHTML="Press/release spacebar to start/end an envelope";var c,f,h=document.createElement("canvas");h.width=1e3,h.height=260,h.style.backgroundColor="black",v.style.margin=h.style.margin="20px 50px",document.body.appendChild(v),document.body.appendChild(h),document.addEventListener("keydown",e=>{" "===e.key&&(e.preventDefault(),function(){if(g)return;g=!0,f||T();var e=f.ctx.currentTime+0,t=f.enveloper,a=f.param;t.startEnvelope(a,e),t.addRamp(a,.5,1,!1),t.addHold(a,.5),t.addRamp(a,.5,.5,!0),t.addSweep(a,0,.2,2)}())}),document.addEventListener("keyup",e=>{" "===e.key&&function(){g=!1,f||T();var e=f.ctx.currentTime+0,t=f.enveloper,a=f.param;t.startEnvelope(a,e),t.addSweep(a,0,0,.4)}()}),function e(){if(requestAnimationFrame(e),f){c||function(){var e=h.getContext("2d");e.fillStyle="#000",e.fillRect(0,0,h.width,h.height);var t=new Float32Array(256);c={drawCtx:e,data:t,x:2}}(),f.analyzer.getFloatTimeDomainData(c.data);var t=c.x,a=256*c.data.reduce((e,t)=>Math.max(e,t),0);c.drawCtx.fillStyle="#000",c.drawCtx.fillRect(t,0,2,h.height),c.drawCtx.fillStyle="#FFF",c.drawCtx.fillRect(t,h.height-a,2,a),c.x=(t+2)%h.width}}();var g=!1;function T(){var e=new AudioContext,t=e.createOscillator();t.start();var a=e.createGain(),n=e.createAnalyser();t.connect(a),a.connect(e.destination),a.connect(n);var i=a.gain,l=new r(e);l.initParam(i,0),f={ctx:e,enveloper:l,param:i,analyzer:n},y.forEach(t=>t(l,e.createGain().gain))}var y=[],w=(e,t)=>{if(Math.abs(e-t)>.01)throw"?"};y.push((e,t)=>{e.initParam(t,0),e.startEnvelope(t,1),e.addHold(t,1),e.addRamp(t,1,1),w(0,e.getValueAtTime(t,0)),w(0,e.getValueAtTime(t,1)),w(0,e.getValueAtTime(t,2)),w(.5,e.getValueAtTime(t,2.5)),w(1,e.getValueAtTime(t,3)),w(1,e.getValueAtTime(t,4)),e.startEnvelope(t,2.5),e.addHold(t,1),e.addRamp(t,.5,1),w(.25,e.getValueAtTime(t,2.25)),w(.5,e.getValueAtTime(t,2.5)),w(.5,e.getValueAtTime(t,3.5)),w(.75,e.getValueAtTime(t,3.75)),w(1,e.getValueAtTime(t,4)),w(1,e.getValueAtTime(t,5))}),y.push((e,t)=>{e.initParam(t,0),e.startEnvelope(t,1),e.addSweep(t,0,1,1),w(.95,e.getValueAtTime(t,4)),e.addHold(t,1),e.addHold(t,1),w(.632,e.getValueAtTime(t,3)),w(.632,e.getValueAtTime(t,4))}),y.push((e,t)=>{e.initParam(t,0),e.startEnvelope(t,1),e.addRamp(t,1,1),e.startEnvelope(t,10),e.addRamp(t,1,0),w(0,e.getValueAtTime(t,1)),w(1,e.getValueAtTime(t,2)),w(1,e.getValueAtTime(t,5)),w(1,e.getValueAtTime(t,10)),w(0,e.getValueAtTime(t,11))});var E=document.createElement("div");E.style.margin="20px 50px",document.body.appendChild(E),E.innerHTML="ad-hoc test cases";var x=(e,t)=>{var a=document.createElement("button");a.style.margin="10px",a.style.padding="10px",a.innerText=""+e,a.onclick=()=>{f||T(),t(f.enveloper,f.param,f.ctx.currentTime+.1)},E.appendChild(a)};function A(e,t,a,r,n,i){e.addRamp(t,a,1),e.addHold(t,r),e.addRamp(t,n,.8,!0),e.addSweep(t,-1,0,i)}x("break",(e,t,a)=>{e.startEnvelope(t,a)}),x("sweep",(e,t,a)=>{e.startEnvelope(t,a),e.addRamp(t,.5,.9),e.addSweep(t,-1,0,.4)}),x("ramps",(e,t,a)=>{e.startEnvelope(t,a);for(var r=0;r<20;r++)e.addRamp(t,.1,r%2?.3:.7)}),x("adsr",(e,t,a)=>{e.startEnvelope(t,a),A(e,t,.2,.2,.4,.4)}),x("rel",(e,t,a)=>{e.startEnvelope(t,a),A(e,t,.2,.2,.4,.4),e.startEnvelope(t,a+.2),e.addSweep(t,-1,0,.2)}),x("rel",(e,t,a)=>{e.startEnvelope(t,a),A(e,t,.2,.2,.4,.4),e.startEnvelope(t,a+.4),e.addSweep(t,-1,0,.2)}),x("rel",(e,t,a)=>{e.startEnvelope(t,a),A(e,t,.2,.2,.4,.4),e.startEnvelope(t,a+.8),e.addSweep(t,-1,0,.2)})}]);